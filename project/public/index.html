<!DOCTYPE html>
<html>
	<head>
		<title>FXHASH project</title>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="./style.css" />
		<script src="./library/utils/fxhash.js"></script>
		<script src="./library/p5/p5.min.js"></script>

		<script>
			async function loadScript(src) {
				return new Promise((resolve, reject) => {
					const script = document.createElement('script');
					script.src = src;
					script.onload = resolve;
					script.onerror = reject;
					document.head.appendChild(script);
				});
			}

			async function fetchDataAndRunScript() {
				try {
					const response = await fetch('./data.json');
					const data = await response.json();
					console.log(data);

					fx = $fx;
					fxhash = data.seed;
					if (data.seed) {
						fxhash = data.seed;
					} else {
						fxhash = $fx.hash;
					}
					console.log(fxhash);
					fxrand = $fx.rand;
					rand = fxrand;
					features = $fx.getFeatures();
					seed = parseInt(fxrand() * 10000000);
					console.log(seed);

					// Load scripts sequentially after obtaining the data
					await loadScript('./library/utils/utils.js');
					await loadScript('./library/utils/piterNoise.js');
					await loadScript('./library/utils/saveCanvas.js');
					await loadScript('./parameters/params.js');
					await loadScript('./object/mover.js');
					await loadScript('./sketch.js'); // Load the sketch.js file at the end
				} catch (error) {
					console.error('Error fetching or processing data:', error);
				}
			}

			document.addEventListener('DOMContentLoaded', function () {
				console.log('Window loaded. Initiating script loading.');
				fetchDataAndRunScript();
			});
		</script>
	</head>
	<body>
		<!-- WEBPACK will inject the bundle.js here -->
	</body>
</html>
