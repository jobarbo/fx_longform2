class Rect{constructor(t,i,s,h,e,r,a,o,n,m=0,c=0){this.type=e,this.margin=t,this.base=width,width>height&&(this.base=height),this.w_shape=(this.base/2-this.margin)/(a/10+o)/((n+1)/10),this.w_shape=constrain(this.w_shape,this.base/4-this.margin,this.base/2-this.margin),"rectangle"===this.type?0===m&&0===c?(this.ratio=random([1,2/3,3/4,9/16,.625]),this.w=this.w_shape,this.h=this.w*this.ratio):(this.ratio=m/c,this.w=m,this.h=c):0===m&&0===c?(this.ratio=random([1/40,.02,1/70,.01]),this.w=random(this.base/5,this.base/3),this.h=this.w*this.ratio):(this.ratio=m/c,this.w=m,this.h=c),this.x=random(t+this.w/1.35,width-t-this.w/1.35),this.y=random(t+this.w/1.35,height-t-this.w/1.35),this.bgHue=hue(h),this.bgSat=saturation(h),this.bgBright=brightness(h),this.sHue=hue(h),this.sSat=saturation(h),this.sBright=brightness(h),this.rotation=radians(random(s)),this.color=random(i),this.hue=hue(this.color),this.saturation=saturation(this.color),this.brightness=brightness(this.color),this.padding=0,this.center=createVector(this.x,this.y),this.margin=t,this.mask="",this.textureDone=!1,this.runs=100*this.h,this.top_left=createVector(this.x-this.w/2,this.y-this.h/2),this.top_right=createVector(this.x+this.w/2,this.y-this.h/2),this.bottom_right=createVector(this.x+this.w/2,this.y+this.h/2),this.bottom_left=createVector(this.x-this.w/2,this.y+this.h/2),this.points=[this.top_left,this.top_right,this.bottom_right,this.bottom_left],this.left=this.x-this.w/2,this.right=this.x+this.w/2,this.top=this.y-this.h/2,this.bottom=this.y+this.h/2,this.id=o;for(let t=0;t<4;t++)this.points[t]=this.rotatePoint(this.points[t],this.center,this.rotation)}draw(){push(),translate(this.x,this.y),rotate(this.rotation),noStroke(),fill(this.color),rect(0,0,this.w,this.h),strokeWeight(15),pop();var t=window.navigator.userAgent,i=!!t.match(/iPad/i)||!!t.match(/iPhone/i),s=!!t.match(/WebKit/i),h=i&&s&&!t.match(/CriOS/i);this.mask=createGraphics(width,height),h?this.mask.pixelDensity(1):this.mask.pixelDensity(3),this.mask.colorMode(HSB,360,100,100,100),this.mask.rectMode(CENTER),this.mask.background(this.color),this.textureDone||this.createTexture()}rotatePoint(t,i,s){return t.sub(i),t.rotate(s),t.add(i),t}createTexture(){let t=[],i=int(map(this.w,this.base/5-this.margin,this.base/1.35-this.margin,3,10,!0));this.mask.push(),this.mask.translate(this.x,this.y),this.mask.rotate(this.rotation);for(let s=0;s<i;s++){let i=random(-this.w,this.w),h=random(-this.w,this.w);const e=random(this.w/8,this.w/2);t[s]=new Texture(this.rotation,0,0,this.w,this.h,i,h,e,this.color,this.mask)}let s=this.drawTexture(t),h=setInterval((()=>{if(s.next().done){this.mask.noStroke(),this.mask.drawingContext.globalCompositeOperation="destination-in",this.mask.noStroke(),this.mask.fill(this.color),this.mask.rect(0,0,this.w,this.h),this.mask.pop(),image(this.mask,0,0),push(),translate(this.x,this.y),rotate(this.rotation),noFill();let t=map(this.h,0,width-this.margin,.01,2,!0),i=this.hue,s=constrain(this.saturation+40,10,100),e=constrain(this.brightness-40,10,100),r=.5,a=.5;this.sBright>50&&(e=constrain(this.brightness+50,10,100),r=-.15,s=constrain(this.saturation-50,10,100),a=.15);let o=50,n=this.w,m=this.h;for(let h=0;h<50;h++)stroke(i,s,e,o),strokeWeight(t),rect(0,0,n,m),o-=1,n-=t,m-=t,e+=r,s+=a;pop(),this.textureDone=!0,clearInterval(h)}}),0)}*drawTexture(t){let i=0;for(let s=0;s<t.length;s++)for(let h=0;h<this.runs;h++)t[s].display(),i++,i>1e3&&(i=0,yield)}isTextureDone(){return this.textureDone}}