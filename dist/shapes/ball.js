class Ball{constructor(t,i,s,h,e,a,r,n=0){this.margin=t,this.base=width,width>height&&(this.base=height),this.w_shape=(this.base/1.5-this.margin)/(e/5+a)/((r+1)/10),this.w_shape=constrain(this.w_shape,this.base/6-this.margin,this.base/1.5-this.margin),0===n?(this.d=this.w_shape,this.r=this.d/2):(this.r=n,this.d=2*this.r),this.x=random(t+this.d/1.35,width-t-this.d/1.35),this.y=random(t+this.d/1.35,height-t-this.d/1.35),this.sHue=hue(s),this.sSat=saturation(s),this.sBright=brightness(s),this.color=random(i),this.hue=hue(this.color),this.sat=saturation(this.color),this.bri=brightness(this.color),this.alpha=100,this.margin=t,this.textureDone=!1,this.runs=100*this.d,this.id=a}draw(){push(),translate(this.x,this.y),noStroke(),fill(this.hue,this.sat,this.bri,this.alpha),ellipse(0,0,this.d,this.d),pop();var t=window.navigator.userAgent,i=!!t.match(/iPad/i)||!!t.match(/iPhone/i),s=!!t.match(/WebKit/i),h=i&&s&&!t.match(/CriOS/i);this.mask=createGraphics(width,height),h?this.mask.pixelDensity(1):this.mask.pixelDensity(3),this.mask.colorMode(HSB,360,100,100,100),this.mask.background(this.color),this.textureDone||this.createTexture()}createTexture(){let t=[],i=int(map(this.d,this.base/4-this.margin,this.base/1.25-this.margin,3,10,!0));for(let s=0;s<i;s++){let i=random(-this.d,this.d),h=random(-this.d,this.d);const e=random(this.d/8,this.d/2);t[s]=new Texture(0,this.x,this.y,this.d,this.d,i,h,e,this.color,this.mask)}let s=this.drawTexture(t),h=setInterval((()=>{if(s.next().done){this.mask.drawingContext.globalCompositeOperation="destination-in",this.mask.noStroke(),this.mask.fill(this.color),this.mask.ellipse(this.x,this.y,2*this.r,2*this.r),image(this.mask,0,0),noFill();let t=map(this.d,0,width-this.margin,.25,2,!0),i=this.hue,s=constrain(this.sat+40,10,100),e=constrain(this.bri-40,10,100),a=.5,r=.5;this.sBright>50&&(e=constrain(this.bri+50,10,100),a=-.15,s=constrain(this.sat-50,10,100),r=.15);let n=50,o=this.d;for(let h=0;h<50;h++)stroke(i,s,e,n),strokeWeight(t),ellipse(this.x,this.y,o-t+1,o-t+1),n-=1,o-=t,e+=a,s+=r;this.textureDone=!0,clearInterval(h)}}),0)}*drawTexture(t){let i=0;for(let s=0;s<t.length;s++)for(let h=0;h<this.runs;h++)t[s].display(),i++,i>1e3&&(i=0,yield)}isTextureDone(){return this.textureDone}}